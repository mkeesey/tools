<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quick List</title>
  <style>
    :root { color-scheme: light dark; font-family: "Inter", system-ui, -apple-system, sans-serif; }
    body { margin: 0; min-height: 100vh; background: #f6f7fb; color: #13141f; display: flex; justify-content: center; }
    main { width: min(720px, 100%); padding: 1.25rem 1rem 2.5rem; }
    h1 { margin: 0 0 0.75rem; letter-spacing: -0.02em; }
    p { margin: 0 0 1.25rem; color: #3b3d4d; }
    label { display: block; font-weight: 600; margin-bottom: 0.35rem; }
    textarea { width: 100%; min-height: 140px; border-radius: 14px; border: 1px solid #d7d9e2; padding: 0.9rem 1rem; font-size: 1rem; resize: vertical; background: #fff; box-sizing: border-box; }
    textarea:focus { outline: 2px solid #5b8def; outline-offset: 2px; }
    .controls { margin: 1.25rem 0 0.75rem; display: flex; gap: 0.75rem; flex-wrap: wrap; }
    button { flex: 1; padding: 0.9rem 1rem; border-radius: 14px; border: none; background: linear-gradient(135deg, #5b8def, #3f6fd0); color: #fff; font-weight: 700; font-size: 1rem; cursor: pointer; box-shadow: 0 10px 30px rgba(63, 111, 208, 0.3); touch-action: manipulation; min-width: 8rem; }
    button:active { transform: translateY(1px); box-shadow: 0 4px 16px rgba(63, 111, 208, 0.25); }
    button.ghost { background: transparent; border: 1px solid #d7d9e2; color: #3f6fd0; box-shadow: none; }
    button.ghost:active { box-shadow: none; }
    button.danger { background: linear-gradient(135deg, #f96060, #de2d2d); box-shadow: 0 10px 25px rgba(222, 45, 45, 0.35); }
    button.danger:active { box-shadow: 0 6px 18px rgba(222, 45, 45, 0.4); }
    button:disabled { opacity: 0.5; cursor: not-allowed; box-shadow: none; }
    .list-card { margin-top: 1.5rem; background: #fff; border: 1px solid #d7d9e2; border-radius: 16px; padding: 1rem; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.04); }
    ul { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 0.5rem; }
    li { display: flex; align-items: center; gap: 0.65rem; background: #f7f8fc; border-radius: 12px; padding: 0.8rem; border: 1px solid #e7e9f2; transition: background 160ms ease, opacity 160ms ease; }
    .list-card label { flex: 1; cursor: pointer; margin: 0; color: inherit; }
    li.completed { background: #e4e7f4; color: #8c91a8; opacity: 0.7; }
    li.completed label { text-decoration: line-through; color: inherit; }
    input[type="checkbox"] {
      flex-shrink: 0;
      width: 22px;
      height: 22px;
      border-radius: 8px;
      border: 2px solid #c2c6d8;
      background: #fff;
      appearance: none;
      display: grid;
      place-items: center;
      transition: background 150ms ease, border-color 150ms ease, box-shadow 150ms ease;
    }
    input[type="checkbox"]::after {
      content: "";
      width: 6px;
      height: 12px;
      border-right: 2px solid #fff;
      border-bottom: 2px solid #fff;
      transform: rotate(45deg);
      opacity: 0;
      transition: opacity 120ms ease;
    }
    input[type="checkbox"]:checked {
      background: #3f6fd0;
      border-color: #3f6fd0;
      box-shadow: 0 4px 12px rgba(63, 111, 208, 0.35);
    }
    input[type="checkbox"]:checked::after { opacity: 1; }
    .empty { color: #5a5d70; font-size: 0.95rem; }
    @media (max-width: 640px) {
      body { background: #eef1f7; }
      main { padding: 1.25rem 0.85rem 2rem; }
      button { font-size: 1.05rem; }
      .controls { flex-direction: column; }
      button.danger { 
        background: transparent; 
        border: 1px solid #d7d9e2; 
        color: #de2d2d; 
        box-shadow: none;
        font-size: 0.9rem;
        padding: 0.7rem 1rem;
        order: 3;
      }
      button.danger:active { 
        box-shadow: none; 
        background: #fef1f1;
      }
      button.ghost { order: 2; }
      #add-btn { order: 1; }
    }

    @media (prefers-color-scheme: dark) {
      body { background: #0e111d; color: #e5e7f1; }
      .list-card { background: #16192a; border-color: #2a2e45; }
      li { background: #1e2135; border-color: #2f3450; color: #f0f2ff; }
      li.completed { background: #181a2b; color: #9da3c7; opacity: 0.6; }
      textarea { background: #0f1322; color: #f2f4ff; border-color: #2c3150; }
      textarea:focus { outline-color: #7da8ff; }
      button.ghost { border-color: #3c4164; color: #9fb6ff; }
      input[type="checkbox"] { border-color: #434864; background: transparent; }
      input[type="checkbox"]:checked { background: #7da8ff; border-color: #7da8ff; }
      .empty { color: #a1a6c4; }
    }

    @media (max-width: 640px) and (prefers-color-scheme: dark) {
      button.danger { 
        border-color: #3c4164; 
        color: #f96060;
      }
      button.danger:active {
        background: #2a1818;
      }
    }
  </style>
</head>
<body>
  <main>
    <h1>Quick List</h1>
    <p>Paste items separated by new lines, tap Add, and manage them as checkboxes.</p>
    <section class="list-card" aria-live="polite" aria-label="Generated checkbox list">
      <ul id="items-list"></ul>
      <p id="empty-note" class="empty">Nothing here yet. Add some items using the form below.</p>
    </section>

    <form id="input-form">
      <div class="controls">
        <button type="submit" id="add-btn">Add</button>
        <button type="button" id="clear-btn" class="ghost" aria-live="off">Clear checked</button>
        <button type="button" id="clear-all-btn" class="danger" aria-live="off">Remove all</button>
      </div>
      <label for="items">Items</label>
      <textarea id="items" name="items" placeholder="Milk&#10;Bread&#10;Eggs" aria-describedby="helper"></textarea>
      <p id="helper" class="empty">Each line becomes its own checkbox item.</p>
    </form>
  </main>

  <script>
    const form = document.getElementById('input-form');
    const textarea = document.getElementById('items');
    const list = document.getElementById('items-list');
    const emptyNote = document.getElementById('empty-note');
    const clearBtn = document.getElementById('clear-btn');
    const clearAllBtn = document.getElementById('clear-all-btn');
    const STORAGE_KEY = 'quick-list-items';

    let itemsState = loadItemsFromStorage();
    renderList();

    function generateId() {
      if (window.crypto?.randomUUID) {
        return window.crypto.randomUUID();
      }
      return `item-${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 8)}`;
    }

    function loadItemsFromStorage() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return [];
        return parsed
          .map((item, index) => {
            if (!item || typeof item.text !== 'string') return null;
            return {
              id: typeof item.id === 'string' ? item.id : `restored-${index}-${Date.now()}`,
              text: item.text,
              checked: Boolean(item.checked),
            };
          })
          .filter(Boolean);
      } catch {
        return [];
      }
    }

    function persistState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(itemsState));
      } catch {
        // Ignore storage failures (e.g., private mode)
      }
    }

    function parseInputLines() {
      return textarea.value
        .split(/\r\n?|\n|\r|\u2028|\u2029/)
        .map(line => line.trim())
        .filter(Boolean);
    }

    function addItemsFromInput() {
      const lines = parseInputLines();
      if (!lines.length) {
        textarea.value = '';
        return;
      }
      const newItems = lines.map(text => ({
        id: generateId(),
        text,
        checked: false,
      }));
      const unchecked = itemsState.filter(item => !item.checked);
      const checked = itemsState.filter(item => item.checked);
      itemsState = [...unchecked, ...newItems, ...checked];
      persistState();
      renderList();
      textarea.value = '';
    }

    function renderList() {
      list.innerHTML = '';
      if (!itemsState.length) {
        emptyNote.hidden = false;
        updateControlButtons();
        return;
      }
      emptyNote.hidden = true;
      const fragment = document.createDocumentFragment();
      itemsState.forEach((item) => {
        const li = document.createElement('li');
        li.dataset.id = item.id;
        if (item.checked) li.classList.add('completed');
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.id = item.id;
        checkbox.checked = item.checked;
        const label = document.createElement('label');
        label.setAttribute('for', item.id);
        label.textContent = item.text;
        checkbox.addEventListener('change', () => toggleItem(item.id, checkbox.checked));
        li.addEventListener('click', (event) => {
          if (event.target === checkbox || event.target.tagName === 'LABEL') {
            return;
          }
          checkbox.checked = !checkbox.checked;
          toggleItem(item.id, checkbox.checked);
        });
        li.appendChild(checkbox);
        li.appendChild(label);
        fragment.appendChild(li);
      });
      list.appendChild(fragment);
      updateControlButtons();
    }

    function toggleItem(id, checked) {
      itemsState = itemsState.map(item =>
        item.id === id ? { ...item, checked } : item
      );
      itemsState = [
        ...itemsState.filter(item => !item.checked),
        ...itemsState.filter(item => item.checked),
      ];
      persistState();
      renderList();
    }

    function clearCheckedItems() {
      const nextState = itemsState.filter(item => !item.checked);
      if (nextState.length === itemsState.length) {
        return;
      }
      itemsState = nextState;
      persistState();
      renderList();
    }

    function clearAllItems() {
      if (!itemsState.length) {
        return;
      }
      const message = itemsState.length === 1
        ? 'Remove the only item in your list?'
        : `Remove all ${itemsState.length} items?`;
      if (!window.confirm(`${message} This action cannot be undone.`)) {
        return;
      }
      itemsState = [];
      persistState();
      renderList();
    }

    function updateControlButtons() {
      const hasChecked = itemsState.some(item => item.checked);
      if (clearBtn) {
        clearBtn.disabled = !hasChecked;
      }
      if (clearAllBtn) {
        clearAllBtn.disabled = itemsState.length === 0;
      }
    }

    form.addEventListener('submit', (event) => {
      event.preventDefault();
      addItemsFromInput();
    });

    if (clearBtn) {
      clearBtn.addEventListener('click', clearCheckedItems);
    }
    if (clearAllBtn) {
      clearAllBtn.addEventListener('click', clearAllItems);
    }

    function isEnterKey(event) {
      const key = event.key || event.code || '';
      return key === 'Enter' || key === 'Return' || event.keyCode === 13;
    }

    let shortcutLocked = false;
    function triggerAddShortcut(event) {
      if (shortcutLocked) return;
      shortcutLocked = true;
      event.preventDefault();
      event.stopPropagation();
      addItemsFromInput();
      setTimeout(() => {
        shortcutLocked = false;
      }, 0);
    }

    textarea.addEventListener('keydown', (event) => {
      if (event.shiftKey && isEnterKey(event)) {
        triggerAddShortcut(event);
      }
    });

    textarea.addEventListener('keypress', (event) => {
      if (event.shiftKey && isEnterKey(event)) {
        triggerAddShortcut(event);
      }
    });
  </script>
</body>
</html>
